---
import fs from "node:fs/promises";
import probe from "probe-image-size";
import "photoswipe/style.css";
import GalleryImage from "./GalleryImage.astro";

let allImages: {
  name: string;
  images: image[];
}[] = [];

const albums = await fs.readdir("src/images");

for (const e of albums) {
  const images = await fs.readdir("src/images/" + e);
  let pathImages: image[] = [];
  for (const img of images) {
    const meta = await probe.sync(await fs.readFile(`src/images/${e}/${img}`));

    pathImages.push({
      path: `./src/images/${e}/${img}`,
      width: meta?.width ?? 0,
      height: meta?.height ?? 0,
    });
  }

  allImages.push({
    name: e,
    images: pathImages,
  });
}
---

{
  allImages.reverse().map((album, i) => (
    <div
      class={`w-full min-h-screen ${
        i % 2 === 0 ? "bg-white text-black" : "bg-black text-white"
      } p-16 flex flex-col items-center`}
    >
      <div class="flex justify-between w-full pb-16">
        <div>{album.name.toLocaleLowerCase() + "_2022"}</div>
      </div>
      <div
        id="gallery"
        class={`flex flex-col  md:grid md:grid-cols-[repeat(auto-fill,_minmax(300px,_1fr))] md:grid-rows-[repeat(auto-fit,_300px)] md:grid-flow-dense md:gap-4`}
      >
        {album.images.map((img) => (
          <GalleryImage image={img} />
        ))}
      </div>
      <div class="italic text-sm pt-6 text-right w-full">
        images taken with a vintage lens during a late night walk
      </div>
    </div>
  ))
}

<script>
  import PhotoSwipeLightbox from "photoswipe/lightbox";
  const lightbox = new PhotoSwipeLightbox({
    gallery: "#gallery",
    children: "a",
    allowPanToNext: false,
    allowMouseDrag: true,
    wheelToZoom: true,
    zoom: false,
    counter: false,
    pswpModule: () => import("photoswipe"),
  });

  lightbox.init();
</script>
